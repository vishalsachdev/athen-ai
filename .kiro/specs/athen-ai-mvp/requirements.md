# Requirements Document

## Introduction

Athen-ai is an AI consulting platform specifically tailored for healthcare professionals, designed to guide AI-naive clinicians in effective AI integration in medicine. The MVP focuses on enabling clinicians to create AI-powered workflows for clinical documentation, patient instructions, and prior authorization through a secure, HIPAA-compliant platform with no PHI storage.

## Glossary

- **Platform**: The athen-ai web application system
- **Clinician**: A healthcare professional user with role 'clinician'
- **Plan**: A blueprint generated by the LLM containing structured steps for a clinical workflow
- **Workflow**: An activated instance of a Plan that executes specific clinical tasks
- **Connection**: An authenticated integration with a third-party service provider (e.g., OpenAI, Google)
- **Credit**: The billing unit where 1 credit equals $0.01 USD
- **PHI**: Protected Health Information as defined by HIPAA
- **Vector Store**: De-identified, embedded document chunks stored for semantic search
- **Planner Wizard**: The LLM-driven interface that generates Plans based on user responses
- **Assistant**: The AI support interface that answers platform usage questions
- **Dry-run**: A simulated workflow execution showing fake outputs and cost estimates
- **Redaction**: The automated process of removing HIPAA 18 identifiers from documents
- **Attestation**: A clinician's signed approval with timestamp before inserting AI-generated clinical content

## Requirements

### Requirement 1: User Authentication and Onboarding

**User Story:** As a clinician, I want to create an account and complete onboarding, so that I can access the platform and create AI-powered clinical workflows.

#### Acceptance Criteria

1. WHEN a user submits valid registration credentials, THE Platform SHALL create a new user account with email verification pending
2. WHEN a user clicks the email verification link, THE Platform SHALL mark the account as verified and enable workflow execution capabilities
3. WHEN a user completes the onboarding wizard, THE Platform SHALL capture legal name, role, specialty from ABMS list, and HIPAA acknowledgment
4. IF a user attempts to execute a workflow without completing email verification, THEN THE Platform SHALL block the execution and display a verification required message
5. WHERE Google SSO is configured, THE Platform SHALL allow users to authenticate using their Google account

### Requirement 2: Plan Creation via Planner Wizard

**User Story:** As a clinician, I want to answer guided questions and receive an AI-generated structured plan, so that I can quickly set up clinical workflows without technical expertise.

#### Acceptance Criteria

1. WHEN a user initiates the Planner Wizard, THE Platform SHALL present 7 to 10 questions covering goal, specialty, PHI usage, budget, HIPAA compliance, FDA compliance, team size, urgency, and integrations
2. WHEN a user completes the Planner Wizard questions, THE Platform SHALL generate a structured Plan with steps, costs, time estimates, recommended tools, action links, risks, and prerequisites using the OpenAI LLM
3. WHEN a user edits a Plan step, THE Platform SHALL allow inline editing, reordering, adding, and removing of steps
4. WHEN a user saves a Plan, THE Platform SHALL store the Plan with version number and owner association in the database
5. THE Platform SHALL ask HIPAA and FDA compliance questions regardless of the PHI usage answer provided by the user

### Requirement 3: Workflow Activation and Execution

**User Story:** As a clinician, I want to activate a Plan as a Workflow and execute it step-by-step, so that I can automate clinical tasks with oversight and control.

#### Acceptance Criteria

1. WHEN a user approves a Plan and clicks activate, THE Platform SHALL convert the Plan into a Workflow with status 'planned'
2. WHEN a user initiates a dry-run, THE Platform SHALL display simulated outputs with fake data and estimated credit costs
3. WHEN a user confirms workflow parameters, THE Platform SHALL capture model selection, form design, form fields, EMR link, and additional agents as applicable
4. WHEN a user executes a Workflow step, THE Platform SHALL wait for user confirmation before proceeding to the next step
5. WHEN a Workflow completes execution, THE Platform SHALL log detailed step-by-step execution traces and update the status to 'active'

### Requirement 4: Provider Connections Management

**User Story:** As a clinician, I want to connect third-party AI providers to my account, so that I can use their services in my workflows.

#### Acceptance Criteria

1. WHEN a user initiates a connection to OpenAI, THE Platform SHALL present OAuth flow or API key entry interface with minimal navigation away from the application
2. WHEN a user completes connection authentication, THE Platform SHALL store the encrypted secret in the secure vault with user or org scope
3. WHEN a user tests a connection, THE Platform SHALL validate authentication, execute a minimal API call, check rate limits and quota, and display tier information with estimated monthly charges
4. WHEN a user views connection details, THE Platform SHALL display provider name, authentication status, scopes, last validated timestamp, and estimated costs
5. THE Platform SHALL allow users to maintain multiple connections to the same provider with personal or org-level ownership

### Requirement 5: File Upload and De-identification

**User Story:** As a clinician, I want to upload clinical documents and have PHI automatically redacted, so that I can safely use the content in AI workflows without HIPAA violations.

#### Acceptance Criteria

1. WHEN a user uploads a file, THE Platform SHALL require the user to flag whether the file contains PHI
2. WHEN a user uploads a PHI-flagged file, THE Platform SHALL execute automated redaction of HIPAA 18 identifiers and present a preview showing before and after states
3. WHEN a clinician approves the redaction preview, THE Platform SHALL vectorize the de-identified content, store embeddings in the Vector Store, and delete the original file
4. IF a clinician does not approve the redaction preview, THEN THE Platform SHALL allow re-running redaction with different settings or deleting the file
5. THE Platform SHALL support PDF, Word, Excel, JPG, PNG, and HL7 FHIR message file formats

### Requirement 6: Vector Store and Knowledge Base Search

**User Story:** As a clinician, I want to search my uploaded documents semantically, so that I can retrieve relevant clinical information for workflow inputs.

#### Acceptance Criteria

1. WHEN a user performs a knowledge base search, THE Platform SHALL default to searching only the current user's Vector Store
2. WHEN the Platform vectorizes a document, THE Platform SHALL chunk the content, generate embeddings, and store metadata excluding patient identifiers
3. WHEN the Platform encounters patient identifiers during vectorization, THE Platform SHALL replace them with cryptographically random unlinkable identifiers consistent within the user's Vector Store
4. THE Platform SHALL retain vectorized data indefinitely by default unless the user explicitly deletes it
5. WHERE a user enables org search, THE Platform SHALL include org-level Vector Store content in search results

### Requirement 7: Credit-Based Billing System

**User Story:** As a clinician, I want to pay for platform usage with credits, so that I only pay for what I use and can predict costs before running workflows.

#### Acceptance Criteria

1. WHEN the Platform consumes resources for LLM API calls, file uploads, vectorization, or workflow executions, THE Platform SHALL deduct credits at a rate of 1 credit equals $0.01 USD
2. WHEN a user initiates a workflow execution, THE Platform SHALL display estimated credit cost before allowing the user to proceed
3. WHEN a user's credit balance reaches zero, THE Platform SHALL auto-charge for overages using the stored payment method via Stripe
4. THE Platform SHALL display current credit balance on the dashboard and in user settings
5. THE Platform SHALL provide usage analytics showing credit consumption per action type and per Plan or Workflow

### Requirement 8: Clinical Note Drafting

**User Story:** As a clinician, I want to generate specialty-specific clinical notes using AI, so that I can reduce documentation time while maintaining quality and compliance.

#### Acceptance Criteria

1. WHEN a clinician selects note drafting for plastic surgery, orthopedic surgery, general surgery, neurosurgery, or ENT, THE Platform SHALL provide SOAP or H&P templates specific to the selected specialty
2. WHEN a clinician links a patient record, THE Platform SHALL generate a draft note using the linked data and selected template
3. WHEN the Platform generates a note with external sources, THE Platform SHALL include citations as footnotes with URLs and direct links
4. WHEN a clinician reviews an AI-generated note, THE Platform SHALL require attestation via signature capture and approve button before allowing insertion
5. WHEN a clinician attests to a note, THE Platform SHALL log the timestamp, user ID, and note content with edit tracking

### Requirement 9: Patient Instructions Generation

**User Story:** As a clinician, I want to generate patient-friendly instructions in multiple languages, so that my patients can understand their care plans regardless of language barriers.

#### Acceptance Criteria

1. WHEN a clinician requests patient instructions, THE Platform SHALL generate output at 6th to 8th grade reading level
2. THE Platform SHALL support English and Spanish languages for patient instructions in the MVP
3. WHEN the Platform generates patient instructions, THE Platform SHALL surface contraindication warnings if applicable
4. WHEN a clinician reviews patient instructions, THE Platform SHALL require explicit clinician review and approval before finalizing
5. THE Platform SHALL log all patient instruction generations with clinician approval timestamps

### Requirement 10: Prior Authorization Packet Builder

**User Story:** As a clinician, I want to generate prior authorization packets automatically, so that I can reduce administrative burden and improve approval rates.

#### Acceptance Criteria

1. WHEN a clinician initiates prior authorization packet creation, THE Platform SHALL present a checklist-driven data capture interface
2. WHEN a clinician uploads supporting documents, THE Platform SHALL import data from the uploaded files into the packet builder
3. WHEN a clinician completes the packet, THE Platform SHALL generate a standard format packet per insurance company requirements including all necessary documentation
4. THE Platform SHALL allow exporting the completed packet as a PDF file
5. THE Platform SHALL track turnaround time, approval status, appeal status, and denials avoided for each prior authorization packet

### Requirement 11: Assistant Support Interface

**User Story:** As a clinician, I want to ask questions about how to use the platform, so that I can learn features and troubleshoot issues without leaving the application.

#### Acceptance Criteria

1. WHEN a user opens the Assistant panel, THE Platform SHALL display a chat interface powered by OpenAI LLM
2. WHEN a user submits a question to the Assistant, THE Platform SHALL provide answers about platform usage, features, and navigation
3. THE Platform SHALL maintain Assistant conversation history only for the current session in the MVP
4. THE Platform SHALL not provide context-aware assistance based on active page in the MVP
5. WHEN a user closes the browser or logs out, THE Platform SHALL clear the Assistant conversation history

### Requirement 12: Dashboard and Metrics

**User Story:** As a clinician, I want to view basic metrics about my platform usage, so that I can track my productivity and credit consumption.

#### Acceptance Criteria

1. WHEN a user accesses the dashboard, THE Platform SHALL display plans created count, active workflows count, and current credit balance
2. THE Platform SHALL derive all metrics from server-side events and database queries
3. WHEN a user clicks a dashboard metric card, THE Platform SHALL navigate to the detailed view for that metric
4. THE Platform SHALL filter dashboard metrics by selected timeframe
5. THE Platform SHALL display only personal account metrics in the MVP without org-level aggregation

### Requirement 13: Plan Management

**User Story:** As a clinician, I want to create, view, edit, and delete my Plans, so that I can organize and reuse clinical workflow templates.

#### Acceptance Criteria

1. WHEN a user creates a Plan, THE Platform SHALL store it with privacy setting defaulted to 'private'
2. WHEN a user edits a Plan, THE Platform SHALL track edit history with diffs showing changes between versions
3. WHEN a user saves a new version of a Plan, THE Platform SHALL increment the version number and retain all previous versions
4. THE Platform SHALL allow users to toggle privacy settings between 'private', 'org', and 'public' for each Plan
5. WHEN a user deletes a Plan, THE Platform SHALL remove it from the database and prevent future access

### Requirement 14: Workflow Monitoring and Status Management

**User Story:** As a clinician, I want to monitor my active Workflows and change their status, so that I can control when workflows run and manage costs.

#### Acceptance Criteria

1. WHEN a user views the Workflows list, THE Platform SHALL display status, last run timestamp, next steps, and ownership for each Workflow
2. WHEN a user transitions a Workflow from 'planned' to 'active', THE Platform SHALL enable execution and credit consumption
3. WHEN a user pauses an active Workflow, THE Platform SHALL change status to 'paused' and stop execution and charges
4. WHEN a user resumes a paused Workflow, THE Platform SHALL change status to 'active' and re-enable execution
5. THE Platform SHALL provide detailed execution logs showing all steps and outcomes for each Workflow run

### Requirement 15: Security and Audit Logging

**User Story:** As a platform administrator, I want comprehensive audit logs of all user actions, so that I can ensure HIPAA compliance and investigate security incidents.

#### Acceptance Criteria

1. WHEN a user performs any action involving PHI, connections, Plans, Workflows, or file operations, THE Platform SHALL create an audit log entry with actor user ID, action type, target type, target ID, timestamp, IP address, and metadata
2. THE Platform SHALL retain all audit logs indefinitely without deletion
3. THE Platform SHALL encrypt all secrets at rest using AWS KMS or GCP KMS with platform-managed keys
4. WHEN the Platform detects anomalous activity including unusual location, high-volume downloads, or attempts to share data outside org, THE Platform SHALL flag the activity for review
5. THE Platform SHALL enforce role-based access controls with least-privilege by default for all resources

### Requirement 16: Data Retention and Privacy

**User Story:** As a clinician, I want control over my data retention, so that I can comply with my organization's policies and patient privacy requirements.

#### Acceptance Criteria

1. THE Platform SHALL retain all vectorized data indefinitely by default
2. WHEN a user deletes a file or Vector Store entry, THE Platform SHALL permanently remove the data and embeddings
3. THE Platform SHALL not store any PHI in persistent storage after vectorization completes
4. WHEN the Platform processes PHI-flagged files, THE Platform SHALL use temporary HIPAA-compliant encrypted storage only during vectorization
5. THE Platform SHALL delete original PHI-containing files immediately after vectorization and approval

### Requirement 17: Tool Catalog

**User Story:** As a clinician, I want to browse available AI tools and integrations, so that I can discover capabilities and select appropriate tools for my workflows.

#### Acceptance Criteria

1. WHEN a user accesses the Catalog, THE Platform SHALL display available tools with name, category, pricing, compliance tags, setup complexity, and authentication type
2. THE Platform SHALL allow filtering tools by HIPAA compliance, FDA compliance, pricing tier, and category
3. WHEN a user views tool details, THE Platform SHALL display description, pricing structure, compliance tags, required scopes, rate limits, and setup guide
4. WHEN a user selects a tool from the Catalog, THE Platform SHALL pre-populate the Planner Wizard with the selected tool's constraints
5. THE Platform SHALL combine multiple filters using AND logic when filtering the Catalog

### Requirement 18: Email Notifications

**User Story:** As a clinician, I want to receive email notifications for important events, so that I stay informed about workflow status and account activity.

#### Acceptance Criteria

1. WHEN a user registers, THE Platform SHALL send an email verification message to the provided email address
2. WHEN a Workflow completes execution, THE Platform SHALL send a notification email to the owner with execution summary
3. WHEN a connection token expires, THE Platform SHALL send a reminder email to the user to rotate the secret
4. WHEN a user's credit balance is low, THE Platform SHALL send a warning email before auto-charging for overages
5. WHEN an anomalous activity is detected, THE Platform SHALL send an alert email to the affected user and platform administrators
